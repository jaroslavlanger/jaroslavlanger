<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="sudoku">Sudoku</h1>
<p><code>2021 Feb 08, Jaroslav Langer</code></p>
<h2 id="sample-usage">Sample usage</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve the sudoku from assignment</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./sudoku_solver.py</span> <span class="op">&lt;</span> data/tutorial_example.txt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># See all the options</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./sudoku_solver.py</span> <span class="at">--help</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve sudoku and compare it with prepared solution</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">./sudoku_solver.py</span> <span class="op">&lt;</span> data/instances/s02a.txt <span class="kw">|</span> <span class="fu">diff</span> data/solutions/s02a_s.txt <span class="at">-</span> <span class="kw">|</span> <span class="fu">cat</span> <span class="at">-t</span></span></code></pre></div>
<h2 id="contents">Contents</h2>
<!-- TOC GFM -->
<ul>
<li><a href="#introduction-and-problem-definition">Introduction and Problem Definition</a>
<ul>
<li><a href="#sudoku-defined-as-a-constraint-satisfaction-problem">Sudoku Defined As a Constraint Satisfaction Problem</a></li>
<li><a href="#sudoku-example">Sudoku Example</a></li>
</ul></li>
<li><a href="#algorithms-description">Algorithms Description</a>
<ul>
<li><a href="#backtracking-bt">Backtracking (BT)</a></li>
<li><a href="#maintaining-arc-consistency-mac-bt">Maintaining Arc-Consistency (MAC-BT)</a></li>
<li><a href="#backjumping-bj">Backjumping (BJ)</a></li>
<li><a href="#dynamic-backtracking-dbt">Dynamic backtracking (DBT)</a></li>
<li><a href="#dependency-directed-backtracking-ddbt">Dependency Directed Backtracking (DDBT)</a></li>
</ul></li>
<li><a href="#datasets">Datasets</a></li>
</ul>
<!-- /TOC -->
<h2 id="introduction-and-problem-definition">Introduction and Problem Definition</h2>
<p>Sudoku is a number-placement puzzle. There are more versions of this game, here will be presented the most common one. You are given matrix <span class="math inline">\(M\)</span>, <span class="math inline">\(M \in \{0,1,2,3,4,5,6,7,8,9\}^{9,9}\)</span> (the <span class="math inline">\(0\)</span> can be represented in various ways such as empty space, or any other symbol). The goal is to create matrix <span class="math inline">\(M&#39;\)</span> where following conditions are satisfied:</p>
<ol type="1">
<li><span class="math inline">\(\forall i,j \in \{1,2, \dots, 9\},\quad M_{i,j} \neq 0 \iff M_{i,j} = M&#39;_{i,j}\)</span></li>
<li><span class="math inline">\(\forall i \in \{1,2, \dots, 9\},\quad |\{m: m \in M_{i,:}\}| = 9\)</span></li>
<li><span class="math inline">\(\forall j \in \{1,2, \dots, 9\},\quad |\{m: m \in M_{:,j}\}| = 9\)</span></li>
<li><span class="math inline">\(\forall k,l \in \{1,2,3\},\quad |\{m: m \in M_{k+3n,l+3o},\quad \forall n,o \in \{0,1,2\} \}| = 9\)</span></li>
</ol>
<p>The mathematical definition will be handy for the algorithm. More human-friendly definition offers perhaps <a href="https://en.wikipedia.org/wiki/Sudoku">Wikipedia’s sudoku</a>.</p>
<h3 id="sudoku-defined-as-a-constraint-satisfaction-problem">Sudoku Defined As a Constraint Satisfaction Problem</h3>
<p>Let’s define sudoku as a Constraint Satisfaction Problem to be able to use classical CSP algorithms such as Backtracking or Backjumping.</p>
<p>Sudoku in terms of CSP is an tuple <span class="math inline">\((X, D, C)\)</span>, where</p>
<ul>
<li><span class="math inline">\(X = \{(a,b): \forall a,b \in \{1,2,3,4,5,6,7,8,9\}\}\)</span>, i.e. <span class="math inline">\(X\)</span> is a set of variables, in this case the variables are the indices of matrix <span class="math inline">\(M\)</span> defined above.</li>
<li><span class="math inline">\(D = \{1,2,3,4,5,6,7,8,9\}\)</span></li>
<li><span class="math inline">\(C = \{allDifferent(S)\}\)</span>, where <span class="math inline">\(S\)</span> is a set of <span class="math inline">\(27\)</span> sets. <span class="math inline">\(9\)</span> sets are from all row variables, <span class="math inline">\(9\)</span> sets are from the column variables and <span class="math inline">\(9\)</span> sets are from variables of the <span class="math inline">\(3 \times 3\)</span> continuous non-overlapping boxes. Defined in the fourth condition above.</li>
</ul>
<h3 id="sudoku-example">Sudoku Example</h3>
<p>Following is an example of a sudoku instance. Every number is followed with one senseless symbol (can be anything). Here are zeros represented with space character <code>' '</code>. Both lines starting with a hash symbol <code>#</code> and empty lines are ignored.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>5 3  |  7  |     |</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>6    |1 9 5|     |</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  9 8|     |  6  |</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>#----+-----+------</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>8    |  6  |    3|</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>4    |8   3|    1|</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>7    |  2  |    6|</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>#----+-----+------</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  6  |     |2 8  |</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>     |4 1 9|    5|</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>     |  8  |  7 9|</span></code></pre></div>
<h2 id="algorithms-description">Algorithms Description</h2>
<p>I believe the easiest way to explain an algorithm is to show the pseudocode first.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python Sudoku Solver Pseudocode</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> backtracking_rec(unassigned, matrix):</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">len</span>(unassigned) <span class="op">==</span> <span class="dv">0</span>):              <span class="co"># If all variables are assigned</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> matrix                       <span class="co"># return full matrix</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    var, work_domain <span class="op">=</span> unassigned.popitem() <span class="co"># Choose some unassigned variable</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> work_domain:               <span class="co"># iterate over it&#39;s work domain</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        matrix[var] <span class="op">=</span> value                 <span class="co"># assign the value to the variable</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_consistent(var, matrix):      <span class="co"># Check if the matrix is consistent</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> backtracking_rec(deepcopy(unassigned), matrix<span class="op">=</span>matrix)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (result <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):        <span class="co"># Return result if it is not None,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> result               <span class="co"># None means, the solution was not found</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        matrix[var] <span class="op">=</span> <span class="dv">0</span>                     <span class="co"># unassign the variable and continue</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span>                 <span class="co"># None of later assignments lead to a solution</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> backtracking(matrix):</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    unassigned <span class="op">=</span> indices_of_zero_values(matrix)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    solution <span class="op">=</span>  backtracking_rec(unassigned, matrix)</span></code></pre></div>
<h3 id="backtracking-bt">Backtracking (BT)</h3>
<p>The backtracking algorithm tries to propagate every solution as long as it is possible. If happens that it is not possible to assign any variable, because all assignments are makes the solution be inconsistent (break some rule), than the lastly assigned variable is unassigned and the propagation continues.</p>
<h3 id="maintaining-arc-consistency-mac-bt">Maintaining Arc-Consistency (MAC-BT)</h3>
<p>MAC-BT algorithm works the same way as the backtracking algorithm with one more feature. Before a solution is propagated, every variable of a every work domain is checked if it has an support over the other work domains of all the other variables. In other words if there is a value 3 in some work domain, it checks if it is possible to assign the value 3 to the variable that it does not make any other variable automatically inconsistent.</p>
<h3 id="backjumping-bj">Backjumping (BJ)</h3>
<p>Backjumping is a different approach to the returns. While the backtracking goes always one level up (unassigns the lastly assigned variable) and at the level it tries all the variables, backjumping does this differently. Besides the partial solution it returns a conflict set, i.e. set of variables that down the road causes an inconsistency, if the variable of the return is not in the conflict set, it is useless to try all the different values, because the inconsistency will stay. In such a case the backjumping does not alternate the variable values and goes up until the variable is in the conflict set. Then it tries the other values.</p>
<h3 id="dynamic-backtracking-dbt">Dynamic backtracking (DBT)</h3>
<h3 id="dependency-directed-backtracking-ddbt">Dependency Directed Backtracking (DDBT)</h3>
<h2 id="datasets">Datasets</h2>
<p>For the algorithm functionality checks I download sudoku sets from <a href="http://lipas.uwasa.fi/~timan/sudoku/">Sudoku research page (Timo Mantere &amp; Janne Koljonen, University of Vaasa</a> there are instances and solutions in the data folder. I used their formatting so it is easily comparable. The files are from windows system, so the code returns files with <code>'\r\n'</code> newlines.</p>
</body>
</html>
